<div class="min-h-screen bg-base-200">
  <!-- Header -->
  <div class="bg-base-100 shadow-md">
    <div class="container mx-auto px-4 py-4">
      <h1 class="text-2xl font-bold">Product Management</h1>
      <p class="text-sm text-base-content/70">Update product and variant availability status</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container mx-auto px-4 py-8">
    <!-- Filter Bar -->
    <div class="card bg-base-100 shadow-md mb-6">
      <div class="card-body p-4">
        <div class="flex flex-wrap gap-2">
          <button
            *ngFor="let option of categoryOptions"
            (click)="onCategoryFilterChange($any(option.value))"
            class="btn btn-sm px-4"
            [class.bg-sky-500]="selectedCategory === option.value"
            [class.text-white]="selectedCategory === option.value"
            [class.bg-ghost]="selectedCategory !== option.value"
          >
            {{ option.label }}
          </button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center py-12">
      <span class="loading loading-spinner loading-lg"></span>
      <p class="mt-4">Loading products...</p>
    </div>

    <!-- No Products -->
    <div *ngIf="!isLoading && filteredProducts.length === 0" class="card bg-base-100 shadow-md">
      <div class="card-body text-center py-12">
        <p class="text-lg text-base-content/70">No products found</p>
      </div>
    </div>

    <!-- Products List -->
    <div *ngIf="!isLoading && filteredProducts.length > 0" class="space-y-3">
      <div *ngFor="let product of filteredProducts" class="card bg-base-100 shadow-md">
        <div class="card-body p-4">
          <!-- Product Header -->
          <div class="flex items-start gap-4">
            <!-- Product Image -->
            <div class="avatar">
              <div class="w-20 h-20 rounded-lg">
                <img [src]="product.image" [alt]="product.name" class="object-cover" />
              </div>
            </div>

            <!-- Product Info -->
            <div class="flex-1">
              <div class="flex justify-between items-start">
                <div>
                  <h3 class="text-lg font-bold">{{ product.name }}</h3>
                  <p class="text-sm text-base-content/70">{{ product.description }}</p>
                  <div class="flex items-center gap-2 mt-2">
                    <span class="badge badge-outline">{{ product.category | uppercase }}</span>
                    <span *ngIf="product.isBestSeller" class="badge badge-accent">Best Seller</span>
                  </div>
                </div>
                <div class="text-right">
                  <p class="text-lg font-bold text-olive-green">₱{{ product.price }}</p>
                </div>
              </div>

              <!-- Product Status Controls -->
              <div class="mt-4 bg-base-200 rounded-lg p-3">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-2">
                    <span class="text-sm font-semibold">Product Status:</span>
                    <span class="badge badge-lg" [ngClass]="getStatusBadgeClass(product.status)">
                      {{ getStatusLabel(product.status) | uppercase }}
                    </span>
                  </div>
                  <div class="flex gap-2">
                    <button
                      *ngFor="let status of statusOptions"
                      (click)="updateProductStatus(product, status)"
                      class="btn btn-xs"
                      [class.btn-success]="status === 'available' && product.status !== status"
                      [class.btn-warning]="status === 'sold-out' && product.status !== status"
                      [class.btn-error]="status === 'unavailable' && product.status !== status"
                      [class.btn-outline]="product.status !== status"
                      [disabled]="(product.status || 'available') === status"
                    >
                      {{ status }}
                    </button>
                  </div>
                </div>
              </div>

              <!-- Variants Section -->
              <div *ngIf="product.variants && product.variants.length > 0" class="mt-4">
                <button
                  (click)="toggleProductExpand(product.id)"
                  class="btn btn-sm btn-ghost gap-2"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transition-transform" [class.rotate-90]="isProductExpanded(product.id)" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                  {{ isProductExpanded(product.id) ? 'Hide' : 'Show' }} Variants ({{ product.variants.length }})
                </button>

                <!-- Expanded Variants -->
                <div *ngIf="isProductExpanded(product.id)" class="mt-3 space-y-2 pl-4 border-l-4 border-base-300">
                  <div *ngFor="let variant of product.variants" class="bg-base-200 rounded-lg p-3">
                    <div class="flex items-center justify-between">
                      <div>
                        <p class="font-semibold">{{ variant.label }}</p>
                        <p class="text-sm text-base-content/70">₱{{ variant.price }}</p>
                        <p *ngIf="variant.servings" class="text-xs text-base-content/60">{{ variant.servings }}</p>
                      </div>
                      <div class="flex flex-col items-end gap-2">
                        <span class="badge" [ngClass]="getStatusBadgeClass(variant.status)">
                          {{ getStatusLabel(variant.status) | uppercase }}
                        </span>
                        <div class="flex gap-1">
                          <button
                            *ngFor="let status of statusOptions"
                            (click)="updateVariantStatus(product, variant, status)"
                            class="btn btn-xs"
                            [class.btn-success]="status === 'available' && variant.status !== status"
                            [class.btn-warning]="status === 'sold-out' && variant.status !== status"
                            [class.btn-error]="status === 'unavailable' && variant.status !== status"
                            [class.btn-outline]="variant.status !== status"
                            [disabled]="(variant.status || 'available') === status"
                          >
                            {{ status === 'available' ? 'Avail' : status === 'sold-out' ? 'Sold' : 'Unavail' }}
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
