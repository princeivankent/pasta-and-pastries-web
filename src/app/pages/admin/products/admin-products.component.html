<div class="min-h-screen bg-base-200">
  <!-- Header -->
  <div class="bg-base-100 shadow-sm">
    <div class="container mx-auto px-4 py-6">
      <h1 class="text-3xl font-bold mb-1">Products</h1>
      <p class="text-sm text-base-content/60">Manage product availability</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container mx-auto px-4 py-6 max-w-4xl">
    <!-- Filter Tabs -->
    <div class="tabs tabs-boxed bg-base-100 mb-6 p-1 shadow-sm">
      <button
        *ngFor="let option of categoryOptions"
        (click)="onCategoryFilterChange($any(option.value))"
        class="tab font-medium"
        [class.tab-active]="selectedCategory === option.value"
      >
        {{ option.label }}
      </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex flex-col items-center justify-center py-16">
      <span class="loading loading-spinner loading-lg text-primary"></span>
      <p class="mt-4 text-base-content/60">Loading products...</p>
    </div>

    <!-- No Products -->
    <div *ngIf="!isLoading && filteredProducts.length === 0" class="card bg-base-100 shadow-sm">
      <div class="card-body text-center py-16">
        <p class="text-base-content/50">No products found</p>
      </div>
    </div>

    <!-- Products List -->
    <div *ngIf="!isLoading && filteredProducts.length > 0" class="space-y-4">
      <div *ngFor="let product of filteredProducts" class="card bg-base-100 shadow-sm hover:shadow-md transition-shadow">
        <div class="card-body p-4 md:p-6">
          <!-- Product Header -->
          <div class="flex flex-col sm:flex-row gap-4">
            <!-- Product Image -->
            <div class="avatar flex-shrink-0">
              <div class="w-24 h-24 rounded-lg">
                <img [src]="product.image" [alt]="product.name" class="object-cover" />
              </div>
            </div>

            <!-- Product Info -->
            <div class="flex-1 min-w-0">
              <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-2">
                <div class="flex-1">
                  <h3 class="text-xl font-bold mb-1">{{ product.name }}</h3>
                  <p class="text-sm text-base-content/60 mb-3">{{ product.description }}</p>
                  <div class="flex flex-wrap items-center gap-2">
                    <span class="badge badge-ghost badge-sm">{{ product.category | uppercase }}</span>
                    <span *ngIf="product.isBestSeller" class="badge badge-accent badge-sm">Best Seller</span>
                    <span class="badge badge-lg ml-auto sm:ml-0" [ngClass]="getStatusBadgeClass(product.status)">
                      {{ getStatusLabel(product.status) | uppercase }}
                    </span>
                  </div>
                </div>
                <div class="flex-shrink-0">
                  <div class="text-2xl font-bold text-primary">₱{{ product.price }}</div>
                </div>
              </div>

              <!-- Product Status Controls -->
              <div class="divider my-3"></div>
              <div class="flex flex-col gap-2">
                <label class="text-xs font-semibold text-base-content/70 uppercase tracking-wide">Change Status</label>
                <div class="flex flex-wrap gap-2">
                  <button
                    *ngFor="let status of statusOptions"
                    (click)="confirmStatusChange(product, status, null)"
                    class="btn btn-sm px-4"
                    [ngClass]="{
                      'bg-green-500 hover:bg-green-600 text-white': status === 'available' && (product.status || 'available') === status,
                      'bg-yellow-500 hover:bg-yellow-600 text-white': status === 'sold-out' && (product.status || 'available') === status,
                      'bg-red-500 hover:bg-red-600 text-white': status === 'unavailable' && (product.status || 'available') === status,
                      'border-green-500 text-green-500 hover:bg-green-50': status === 'available' && (product.status || 'available') !== status,
                      'border-yellow-500 text-yellow-500 hover:bg-yellow-50': status === 'sold-out' && (product.status || 'available') !== status,
                      'border-red-500 text-red-500 hover:bg-red-50': status === 'unavailable' && (product.status || 'available') !== status,
                      'border': (product.status || 'available') !== status
                    }"
                    [disabled]="(product.status || 'available') === status"
                  >
                    <svg *ngIf="(product.status || 'available') === status" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                    {{ status === 'available' ? 'Available' : status === 'sold-out' ? 'Sold Out' : 'Unavailable' }}
                  </button>
                </div>
              </div>

              <!-- Variants Section -->
              <div *ngIf="product.variants && product.variants.length > 0" class="mt-4">
                <div class="divider my-2"></div>
                <button
                  (click)="toggleProductExpand(product.id)"
                  class="btn btn-sm bg-transparent hover:bg-gray-100 w-full justify-between px-4"
                >
                  <span class="font-semibold">Variants ({{ product.variants.length }})</span>
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform duration-200" [class.rotate-180]="isProductExpanded(product.id)" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </button>

                <!-- Expanded Variants -->
                <div *ngIf="isProductExpanded(product.id)" class="mt-4 space-y-3 animate-fadeIn">
                  <div *ngFor="let variant of product.variants" class="card bg-base-200 shadow-sm">
                    <div class="card-body p-4">
                      <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-3">
                        <div class="flex-1">
                          <h4 class="font-bold text-base mb-1">{{ variant.label }}</h4>
                          <div class="flex items-center gap-3 text-sm">
                            <span class="font-semibold text-primary">₱{{ variant.price }}</span>
                            <span *ngIf="variant.servings" class="text-base-content/60">{{ variant.servings }}</span>
                          </div>
                          <div class="mt-2">
                            <span class="badge badge-sm" [ngClass]="getStatusBadgeClass(variant.status)">
                              {{ getStatusLabel(variant.status) | uppercase }}
                            </span>
                          </div>
                        </div>
                        <div class="flex flex-wrap gap-2">
                          <button
                            *ngFor="let status of statusOptions"
                            (click)="confirmStatusChange(product, status, variant)"
                            class="btn btn-xs px-3"
                            [ngClass]="{
                              'bg-green-500 hover:bg-green-600 text-white': status === 'available' && (variant.status || 'available') === status,
                              'bg-yellow-500 hover:bg-yellow-600 text-white': status === 'sold-out' && (variant.status || 'available') === status,
                              'bg-red-500 hover:bg-red-600 text-white': status === 'unavailable' && (variant.status || 'available') === status,
                              'border-green-500 text-green-500 hover:bg-green-50': status === 'available' && (variant.status || 'available') !== status,
                              'border-yellow-500 text-yellow-500 hover:bg-yellow-50': status === 'sold-out' && (variant.status || 'available') !== status,
                              'border-red-500 text-red-500 hover:bg-red-50': status === 'unavailable' && (variant.status || 'available') !== status,
                              'border': (variant.status || 'available') !== status
                            }"
                            [disabled]="(variant.status || 'available') === status"
                          >
                            <svg *ngIf="(variant.status || 'available') === status" xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                            </svg>
                            {{ status === 'available' ? 'Avail' : status === 'sold-out' ? 'Sold' : 'Unavail' }}
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<div *ngIf="isConfirmModalOpen" class="modal modal-open">
  <div class="modal-box">
    <h3 class="font-bold text-xl mb-4">Confirm Status Change</h3>
    <p class="text-base-content/70 mb-6">
      Are you sure you want to change the status
      <span *ngIf="pendingChangeVariant">of variant <strong>{{ pendingChangeVariant.label }}</strong></span>
      <span *ngIf="!pendingChangeVariant">of <strong>{{ pendingChangeProduct?.name }}</strong></span>
      to <strong class="capitalize">{{ pendingChangeStatus }}</strong>?
    </p>
    <div class="modal-action">
      <button
        type="button"
        (click)="closeConfirmModal()"
        class="btn bg-gray-100 hover:bg-gray-200 text-gray-700 px-4"
      >
        Cancel
      </button>
      <button
        type="button"
        (click)="confirmAndApplyStatusChange()"
        class="btn text-white px-4"
        [ngClass]="{
          'bg-green-500 hover:bg-green-600': pendingChangeStatus === 'available',
          'bg-yellow-500 hover:bg-yellow-600': pendingChangeStatus === 'sold-out',
          'bg-red-500 hover:bg-red-600': pendingChangeStatus === 'unavailable'
        }"
      >
        Confirm
      </button>
    </div>
  </div>
  <div class="modal-backdrop bg-black/50" (click)="closeConfirmModal()"></div>
</div>
