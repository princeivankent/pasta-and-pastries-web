<!-- Modal backdrop and container -->
<div *ngIf="product" class="modal modal-open" (click)="close()">
  <div class="modal-box max-w-4xl relative p-6" (click)="$event.stopPropagation()">
    <!-- Close button -->
    <button class="btn btn-sm btn-circle bg-transparent hover:bg-gray-100 absolute right-3 top-3 z-10" (click)="close()">✕</button>

    <!-- Modal content -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Product image -->
      <figure class="w-full">
        <div class="w-full aspect-square flex items-center justify-center bg-base-200 rounded-2xl overflow-hidden">
          <img [src]="product.image" [alt]="product.name" class="w-full h-full object-cover" />
        </div>
      </figure>

      <!-- Product details -->
      <div class="flex flex-col space-y-3">
        <div>
          <div class="flex items-center gap-2">
            <h3 class="text-2xl font-heading font-bold text-neutral">{{ product.name }}</h3>
            <span *ngIf="!isProductAvailable()" class="badge badge-lg"
                  [class.badge-warning]="product.status === 'sold-out'"
                  [class.badge-error]="product.status === 'unavailable'">
              {{ getProductStatusLabel() }}
            </span>
          </div>
          <p class="text-2xl font-bold text-olive-green mt-1">₱{{ getCurrentPrice() }}</p>
          <p class="text-sm text-base-content/70 leading-relaxed font-body mt-2">{{ product.description }}</p>
        </div>

        <!-- Variant selector -->
        <div class="form-control" *ngIf="hasVariants()">
          <label class="label py-1">
            <span class="label-text font-semibold text-sm">Select Size</span>
          </label>
          <div class="flex flex-col gap-2">
            <label
              *ngFor="let variant of product.variants"
              class="label justify-start gap-3 p-3 border-2 rounded-lg transition-all"
              [ngClass]="{
                'border-olive-green bg-olive-green/5': selectedVariant?.id === variant.id && isVariantAvailable(variant),
                'border-base-300 hover:border-olive-green/50': selectedVariant?.id !== variant.id && isVariantAvailable(variant),
                'border-base-300 bg-base-300/30 opacity-60': !isVariantAvailable(variant),
                'cursor-pointer': isVariantAvailable(variant),
                'cursor-not-allowed': !isVariantAvailable(variant)
              }"
            >
              <input
                type="radio"
                name="variant"
                class="radio radio-primary"
                [checked]="selectedVariant?.id === variant.id"
                [disabled]="!isVariantAvailable(variant)"
                (change)="selectVariant(variant)"
              />
              <div class="flex-1">
                <div class="flex justify-between items-baseline">
                  <div class="flex items-center gap-2">
                    <span class="label-text font-bold">{{ variant.label }}</span>
                    <span *ngIf="!isVariantAvailable(variant)" class="badge badge-sm"
                          [class.badge-warning]="variant.status === 'sold-out'"
                          [class.badge-error]="variant.status === 'unavailable'">
                      {{ getVariantStatusLabel(variant) }}
                    </span>
                  </div>
                  <span class="text-olive-green font-bold">₱{{ variant.price }}</span>
                </div>
                <div class="text-xs text-base-content/60 mt-1" *ngIf="variant.servings">{{ variant.servings }}</div>
                <div class="text-xs text-base-content/50 mt-0.5" *ngIf="variant.dimensions">{{ variant.dimensions }}</div>
              </div>
            </label>
          </div>
        </div>

        <!-- Quantity selector -->
        <div class="form-control">
          <label class="label py-1">
            <span class="label-text font-semibold text-sm">Quantity</span>
          </label>
          <div class="flex items-center gap-3">
            <button class="btn btn-sm btn-circle btn-outline" (click)="decrementQuantity()">−</button>
            <input
              type="number"
              [(ngModel)]="quantity"
              min="1"
              class="input input-sm input-bordered w-16 text-center"
              readonly
            />
            <button class="btn btn-sm btn-circle btn-outline" (click)="incrementQuantity()">+</button>
          </div>
        </div>

        <!-- Special instructions -->
        <div class="form-control">
          <label class="label py-1">
            <span class="label-text font-semibold text-sm">Special Instructions (Optional)</span>
          </label>
          <textarea
            [(ngModel)]="specialInstructions"
            class="textarea textarea-bordered textarea-sm h-16 text-sm"
            placeholder="Any special requests or dietary requirements?"
          ></textarea>
        </div>

        <!-- Add to cart button -->
        <div class="mt-auto pt-2">
          <button
            [ngClass]="{
              'btn': true,
              'btn-lg': true,
              'w-full': true,
              'border-none': true,
              'transition-all': true,
              'duration-300': true,
              'bg-olive-green': !justAdded,
              'text-white': !justAdded,
              'hover:bg-olive-green/90': !justAdded,
              'bg-success': justAdded,
              'text-success-content': justAdded,
              'px-6': true
            }"
            [disabled]="isAdding || !canAddToCart()"
            (click)="addToCart()"
          >
            <span *ngIf="!justAdded && canAddToCart()" class="flex items-center justify-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
              <span>Add to Cart - ₱{{ getCurrentPrice() * quantity }}</span>
            </span>
            <span *ngIf="!justAdded && !canAddToCart() && !isProductAvailable()" class="flex items-center justify-center gap-2">
              <span>{{ getProductStatusLabel() }}</span>
            </span>
            <span *ngIf="!justAdded && !canAddToCart() && isProductAvailable() && hasVariants() && !selectedVariant" class="flex items-center justify-center gap-2">
              <span>Please select a size</span>
            </span>
            <span *ngIf="!justAdded && !canAddToCart() && isProductAvailable() && hasVariants() && selectedVariant && !isVariantAvailable(selectedVariant)" class="flex items-center justify-center gap-2">
              <span>{{ getVariantStatusLabel(selectedVariant) }}</span>
            </span>
            <span *ngIf="justAdded" class="flex items-center justify-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 animate-bounce" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              <span>Added to Cart!</span>
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
